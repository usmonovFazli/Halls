<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>To‚Äôyxona</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        section {
            margin-bottom: 30px;
        }

        input,
        button {
            margin: 5px;
            padding: 5px;
        }

        .card {
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 10px;
        }
    </style>
</head>

<body>

    <h1>To‚Äôyxona Frontend ü•≥</h1>

    <section>
        <h2>üîê –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
        <input id="regUsername" placeholder="Username" />
        <input id="regPassword" placeholder="Password" type="password" />
        <select id="regRole">
            <option value="user">User</option>
            <option value="owner">Owner</option>
        </select>
        <button onclick="register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    </section>

    <section>
        <h2>üîë –í—Ö–æ–¥</h2>
        <input id="loginUsername" placeholder="Username" />
        <input id="loginPassword" placeholder="Password" type="password" />
        <button onclick="login()">–í–æ–π—Ç–∏</button>
    </section>

    <section>
        <h2>üèõ –°–æ–∑–¥–∞—Ç—å –¢–æ–π—Ö–æ–Ω–∞ (—Ç–æ–ª—å–∫–æ Owner/Admin)</h2>
        <input id="hallName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" />
        <input id="hallDistrict" placeholder="–†–∞–π–æ–Ω" />
        <input id="hallAddress" placeholder="–ê–¥—Ä–µ—Å" />
        <input id="hallCapacity" type="number" placeholder="–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å" />
        <input id="hallPrice" type="number" placeholder="–¶–µ–Ω–∞ –∑–∞ –º–µ—Å—Ç–æ" />
        <input id="hallPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" />
        <button onclick="createHall()">–°–æ–∑–¥–∞—Ç—å –∑–∞–ª</button>
    </section>

    <section>
        <h2>üé™ –°–ø–∏—Å–æ–∫ –¢–æ–π—Ö–æ–Ω</h2>
        <button onclick="getHalls()">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ</button>
        <div id="hallList"></div>
    </section>

    <section>
        <h2>üìÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</h2>
        <input id="bookingHallId" placeholder="ID –∑–∞–ª–∞" />
        <input id="bookingDate" type="date" />
        <input id="bookingGuests" type="number" placeholder="–ì–æ—Å—Ç–∏" />
        <input id="bookingName" placeholder="–§–ò–û" />
        <input id="bookingPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" />
        <button onclick="createBooking()">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
    </section>

    <script>
        const API = 'http://localhost:3223/api';
        let token = null;

        function setToken(t) {
            token = t;
            axios.defaults.headers.common['Authorization'] = 'Bearer ' + token;
        }

        async function register() {
            const username = regUsername.value;
            const password = regPassword.value;
            const role = regRole.value;
            try {
                const res = await axios.post(`${API}/auth/register`, { username, password, role });
                alert('‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ' + res.data.user.username);
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + err.response.data.message);
            }
        }

        async function login() {
            const username = loginUsername.value;
            const password = loginPassword.value;
            try {
                const res = await axios.post(`${API}/auth/login`, { username, password });
                setToken(res.data.token);
                alert('üîì –í–æ—à–ª–∏ –∫–∞–∫: ' + res.data.user.username);
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + (err.response?.data?.message || err.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            }
        }


        async function createHall() {
            try {
                const data = {
                    name: hallName.value,
                    district: hallDistrict.value,
                    address: hallAddress.value,
                    capacity: +hallCapacity.value,
                    price_per_seat: +hallPrice.value,
                    phone: hallPhone.value
                };
                const res = await axios.post(`${API}/halls`, data);
                alert('üéâ –ó–∞–ª —Å–æ–∑–¥–∞–Ω: ' + res.data.name);
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + err.response.data.message);
            }
        }

        async function getHalls() {
            try {
                const res = await axios.get(`${API}/halls`);
                const container = document.getElementById('hallList');
                container.innerHTML = '';
                res.data.forEach(hall => {
                    const el = document.createElement('div');
                    el.className = 'card';
                    el.innerHTML = `
            <strong>${hall.name}</strong> ‚Äî ${hall.district}<br/>
            –í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ${hall.capacity}, –¶–µ–Ω–∞: ${hall.price_per_seat}<br/>
            –°—Ç–∞—Ç—É—Å: ${hall.status}
          `;
                    container.appendChild(el);
                });
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–ª–æ–≤');
            }
        }

        async function createBooking() {
            try {
                const data = {
                    hall_id: +bookingHallId.value,
                    booking_date: bookingDate.value,
                    guest_count: +bookingGuests.value,
                    full_name: bookingName.value,
                    phone: bookingPhone.value
                };
                const res = await axios.post(`${API}/bookings`, data);
                alert('‚úÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ ' + res.data.booking_date);
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: ' + err.response.data.message);
            }
        }
    </script>
</body>

</html>